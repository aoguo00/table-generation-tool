<div class="container">
  <!-- 顶部导航 -->
  <nz-tabset>
    <nz-tab nzTitle="查询/上传"></nz-tab>
    <nz-tab nzTitle="第三方设备点位"></nz-tab>
  </nz-tabset>

  <!-- 查询条件 -->
  <div class="query-section">
    <div class="query-form">
      <div class="form-row">
        <div class="form-group">
          <label>项目编号:</label>
          <div class="search-wrapper">
            <input type="text" nz-input #projectInput placeholder="输入项目编号" value="OPP.23110200272">
            <button nz-button nzType="primary" (click)="queryProject(projectInput.value)">
              <span nz-icon nzType="search"></span>
            </button>
          </div>
        </div>
        <div class="form-group">
          <label>场站编号:</label>
          <div class="search-wrapper">
            <input type="text" nz-input placeholder="输入场站编号">
          </div>
        </div>
      </div>

      <div class="button-row">
        <button nz-button nzType="default" (click)="clearForm()" [nzLoading]="isLoading">清空</button>
        <button nz-button nzType="primary" (click)="generatePointTable()" [nzLoading]="isLoading">生成点表</button>
        <button nz-button nzType="default" (click)="uploadPointTable('普通')" [disabled]="true">上传点表</button>
        <button nz-button nzType="default" (click)="uploadPointTable('FAT')" [disabled]="true">上传FAT点表</button>
        <button nz-button nzType="default" (click)="uploadPointTable('HMI')" [disabled]="true">上传HMI点表</button>
        <button nz-button nzType="default" (click)="uploadPointTable('PLC')" [disabled]="true">上传PLC点表</button>
      </div>
    </div>
  </div>

  <!-- 加载状态 -->
  <nz-spin [nzSpinning]="isLoading" nzTip="数据加载中...">

    <!-- 项目列表 -->
    <div class="project-list-section" *ngIf="projectData.length > 0">
      <h3>项目列表</h3>
      <nz-table #projectTable [nzData]="projectData" 
                [nzFrontPagination]="false" 
                [nzShowPagination]="false">
        <thead>
          <tr>
            <th nzWidth="50px">编号</th>
            <th nzWidth="30%">项目名称</th>
            <th nzWidth="12%">场站</th>
            <th nzWidth="12%">项目编号</th>
            <th nzWidth="12%">深化设计编号</th>
            <th>客户名称</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of projectTable.data; let i = index" 
              [class.selected]="selectedProject === item"
              (click)="selectProject(item)">
            <td>{{i + 1}}</td>
            <td>{{item.project_name}}</td>
            <td>{{item.station_name}}</td>
            <td>{{item.project_number}}</td>
            <td>{{item.design_number}}</td>
            <td>{{item.customer_name}}</td>
          </tr>
        </tbody>
      </nz-table>
    </div>

    <!-- 设备清单 -->
    <div class="equipment-list-section" *ngIf="selectedProject">
      <h3>设备清单 - {{selectedProject.station_name}}</h3>
      
      <nz-table #equipmentTable [nzData]="equipmentData"
                [nzFrontPagination]="false"
                [nzShowPagination]="false">
        <thead>
          <tr>
            <th nzWidth="50px">序号</th>
            <th nzWidth="18%">设备名称</th>
            <th nzWidth="8%">品牌</th>
            <th nzWidth="12%">规格型号</th>
            <th nzWidth="25%">技术参数</th>
            <th nzWidth="60px">数量</th>
            <th nzWidth="60px">单位</th>
            <th>技术参数(外部)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of equipmentTable.data; let i = index">
            <td>{{i + 1}}</td>
            <td>{{item.name}}</td>
            <td>{{item.brand}}</td>
            <td>{{item.model}}</td>
            <td>{{item.tech_param}}</td>
            <td>{{item.quantity}}</td>
            <td>{{item.unit}}</td>
            <td>{{item.external_param}}</td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-spin>
</div>

